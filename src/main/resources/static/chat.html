<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>1:1 Chat</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1.5.0/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
</head>
<body>
<h2>1:1 채팅</h2>
<label>보낸 사람: <input type="text" id="sender" /></label><br>
<label>받는 사람: <input type="text" id="recipient" /></label><br>
<label>대화방 ID: <input type="text" id="roomId" /></label><br>
<label>메시지 내용: <input type="text" id="messageContent" /></label><br>
<button onclick="sendMessage()">메시지 보내기</button>

<h3>받은 메시지</h3>
<div id="messages"></div>

<script type="text/javascript">
    let stompClient = null;

    function connect() {
        const socket = new SockJS('/ws');
        stompClient = Stomp.over(socket);
        stompClient.connect({}, function (frame) {
            const sender = document.getElementById("sender").value;
            const roomId = document.getElementById("roomId").value;

            // 수신 경로를 대화방 ID를 사용하여 구독
            stompClient.subscribe('/user/' + sender + '/queue/messages/' + roomId, function (message) {
                const messageContent = JSON.parse(message.body).content;
                document.getElementById("messages").innerHTML += "<p>" + messageContent + "</p>";
            });
        });
    }

    function sendMessage() {
        const sender = document.getElementById("sender").value;
        const recipient = document.getElementById("recipient").value;
        const roomId = document.getElementById("roomId").value;
        const content = document.getElementById("messageContent").value;

        stompClient.send("/app/chat", {}, JSON.stringify({
            sender: sender,
            recipient: recipient,
            content: content,
            roomId: roomId
        }));
    }

    connect(); // 페이지 로드 시 연결
</script>
</body>
</html>
